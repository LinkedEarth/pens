
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Ensemble resampling &#8212; pens  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=db61ab07" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=fca5bd30" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/eg24-Fig5_resampling';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Proximity Probability and Plume Distance" href="eg24-Fig6_8_plume_distance.html" />
    <link rel="prev" title="Making Figures 3 &amp; 4" href="eg24-Fig3_4_LMRonline.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">pens  documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../ug-installation.html">Installation</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../ug-eg24.html">Emile-Geay et al. (2024)</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="eg24-Fig1_motivation.html">Motivation for the study</a></li>
<li class="toctree-l2"><a class="reference internal" href="eg24-Fig2_naive_resampling.html">Reproducing Fig 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="eg24-Fig3_4_LMRonline.html">Making Figures 3 &amp; 4</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Ensemble resampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="eg24-Fig6_8_plume_distance.html">Proximity Probability and Plume Distance</a></li>
<li class="toctree-l2"><a class="reference internal" href="eg24-Fig9_plume_distance-schematic.html">Schematic for the Plume Distance</a></li>
<li class="toctree-l2"><a class="reference internal" href="eg24-Fig10_compare_PAGES2k2019_recons.html">Consistency of the PAGES 2k ensemble</a></li>
<li class="toctree-l2"><a class="reference internal" href="eg24-Fig11_12_compare_LMRvsB21.html">LMR v2.1 vs Büntgen et al ensemble</a></li>
<li class="toctree-l2"><a class="reference internal" href="eg24-Tab1_LMR_PMIP3_proximity_table.html">Proximity of PMIP3 traces to LMR ensembles</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../ug-api.html">API Reference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/fzhu2e/pens" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/fzhu2e/pens/edit/main/notebooks/eg24-Fig5_resampling.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/fzhu2e/pens/issues/new?title=Issue%20on%20page%20%2Fnotebooks/eg24-Fig5_resampling.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/eg24-Fig5_resampling.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Ensemble resampling</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Independent-constraints-on-temporal-structure">Independent constraints on temporal structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Resampling-the-offline-LMR">Resampling the offline LMR</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#AR-resampling">AR resampling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Power-law-scaling">Power law scaling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fGn-resampling">fGn resampling</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Conclusion">Conclusion</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Ensemble-resampling">
<h1>Ensemble resampling<a class="headerlink" href="#Ensemble-resampling" title="Link to this heading">#</a></h1>
<p>Like other offline data assimilation products, the Last Millennium Reanaalysis was generated from an Ensemble Kalman Filter, which samples from a time-invariant prior distribution of climate states before judging its consistency with the observations. By definition, offline DA treats each reconstruction interval (here, years), as independent; in fact, the algorithm works identically if years are swapped, exchanged with replacement, etc. Thus, any trajectory encompassed by these distributions is
technically allowed, as long as these paths preserve the distribution, particularly its low-order moments (mean, variance). However, within those loose constraints, not all resampling choices are equivalent, as some may result in a temporal structure that no longer respects what is independently known about climate variability (e.g. long-range memory). The challenge is thus to come up with resampling schemes that satisfy both constraints: - respect the posterior distribution obtained via the
Kalman filter - respect independent constraints on temporal structure.</p>
<p>This notebooks illustrates these challenges by apply a naïve resampling strategy to the LMR ensemble, before briging other constraints to bear. It concludes with Fig 5 of the paper.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="kn">import</span> <span class="nn">pens</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
<span class="n">pens</span><span class="o">.</span><span class="n">set_style</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>We first load the LMR v2.1 global mean surface temperature (GMST) for illustration:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;../data/gmt_MCruns_ensemble_full_LMRv2.1.nc&#39;</span>
<span class="n">ens_LMR</span> <span class="o">=</span> <span class="n">pens</span><span class="o">.</span><span class="n">EnsembleTS</span><span class="p">()</span><span class="o">.</span><span class="n">load_nc</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s1">&#39;gmt&#39;</span><span class="p">)</span>
<span class="n">ens_LMR</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;LMR v2.1&#39;</span>
<span class="n">ens_LMR</span><span class="o">.</span><span class="n">value_name</span> <span class="o">=</span> <span class="s1">&#39;GMST&#39;</span>
<span class="n">ens_LMR</span><span class="o">.</span><span class="n">value_unit</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\N{DEGREE SIGN}</span><span class="s1">C&#39;</span>
<span class="n">ens_LMR</span><span class="o">.</span><span class="n">plot_qs</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: title={&#39;center&#39;: &#39;LMR v2.1&#39;}, xlabel=&#39;time&#39;, ylabel=&#39;GMST [°C]&#39;&gt;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_3_1.png" src="../_images/notebooks_eg24-Fig5_resampling_3_1.png" />
</div>
</div>
<p>As expected from the loss of degrees of freedom due to proxy attribution, the ensemble spread increases back in time, while the ensemble median becomes increasingly flat. In other words, there is a generally inverse relationship between the temporal variance of the distribution’s central moment (the median or mean) and the variance across the ensemble at a fixed time. The individual trajectories that make up the ensemble may be visualized thus:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ens_LMR</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span><span class="n">num_traces</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;indianred&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 1000x400 with 1 Axes&gt;, &lt;Axes: xlabel=&#39;time&#39;, ylabel=&#39;GMST [°C]&#39;&gt;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_5_1.png" src="../_images/notebooks_eg24-Fig5_resampling_5_1.png" />
</div>
</div>
<p>Notice that the same inverse relationship holds true for each of these ensemble members: their temporal fluctuations diminish back in time, while their get spread further apart. However, it is important to realize that these trajectories are simply labels: trajectory <span class="math notranslate nohighlight">\(i\)</span> is simply the <span class="math notranslate nohighlight">\(i\)</span>th member of this ranked ensemble, but one could just as legitimately reshuffle labels at each time step, like so:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ens_unif</span> <span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">random_paths</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;unif&#39;</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ens_unif</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">num_traces</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_7_0.png" src="../_images/notebooks_eg24-Fig5_resampling_7_0.png" />
</div>
</div>
<p>The resampling results in a much greater temporal variance, with many “cold” years from the posterior (usually, those corresponding to the aftermath of strong volcanic eruptions in the CCSM4 prior) being sampled with replacement. However, it is easy to check that the ensemble variance is unchanged:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">get_std</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;original ensemble&#39;</span><span class="p">)</span>
<span class="n">ens_unif</span><span class="o">.</span><span class="n">get_std</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;uniform resampling&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Ensemble standard deviation&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x1a7d42610&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_9_1.png" src="../_images/notebooks_eg24-Fig5_resampling_9_1.png" />
</div>
</div>
<p>How do we satisfy these constraints while respecting the laws of physics as they apply to the temporal structure of climate variability? To do this, we need to bring in independent information.</p>
<section id="Independent-constraints-on-temporal-structure">
<h2>Independent constraints on temporal structure<a class="headerlink" href="#Independent-constraints-on-temporal-structure" title="Link to this heading">#</a></h2>
<p>This information may come in several forms, e.g. studies of instrumental climate variability, which suggest that the spectrum of GMST <span class="math notranslate nohighlight">\(S(f)\)</span> behaves as a power law of the form <span class="math notranslate nohighlight">\(S(f) \propto f^{-\beta}\)</span>, where <span class="math notranslate nohighlight">\(\beta \approx 1\)</span> over the instrumental era (see e.g. Huybers &amp; Curry [2005] or Zhu et al. [2019]). However, the last 150 years are too short to usefully distringhuish between several models of temporal behavior, such as long- or short-range memory (e.g. Barboza et al
2014).</p>
<p>Another constraint comes from the temporal behavior of the online LMR algorithm of Perkins &amp; Hakim [2021]. Unlike offline DA, online DA carries information from timestep to timestep via an explicit model (here, a linear inverse model, or LIM). This results in much improved reconstruction of quantities, like the ocean heat content, that are known to exhibit long-term memory but are only indirectly constrained by most climate proxy observations. To a lesser extent, Perkins &amp; Hakim [2021] also
showed improved reconstructions of GMST, with a narrower ensemble spread and more homoskedastic behavior of the ensemble mean (or median). Let us load and visualize this reconstruction:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ens_o</span> <span class="o">=</span> <span class="n">pens</span><span class="o">.</span><span class="n">EnsembleTS</span><span class="p">()</span><span class="o">.</span><span class="n">load_nc</span><span class="p">(</span><span class="s1">&#39;../data/gmt_MCruns_ensemble_full_LMRonline.nc&#39;</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s1">&#39;glob_mean&#39;</span><span class="p">,</span> <span class="n">time_name</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">)</span>
<span class="n">ens_o</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;LMR online&#39;</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ens_o</span><span class="o">.</span><span class="n">plot_qs</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;GMST [K]&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_11_0.png" src="../_images/notebooks_eg24-Fig5_resampling_11_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ens_o</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span><span class="n">num_traces</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 1000x400 with 1 Axes&gt;, &lt;Axes: xlabel=&#39;time&#39;, ylabel=&#39;value&#39;&gt;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_12_1.png" src="../_images/notebooks_eg24-Fig5_resampling_12_1.png" />
</div>
</div>
<p>The individual traces also retain more temporal variance than their offline counterparts (see above).</p>
<p>To devise a sensible resampling scheme, we analyze the spectral behavior of the online LMR to determine which timeseries model would be most appropriate. Because the ensemble mean may be viewed as a deterministic response to external forcing (e.g. explosive volcanism), we analyze the spectral behaior of residuals from the mean:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ens_o2000</span> <span class="o">=</span> <span class="n">ens_o</span><span class="o">.</span><span class="n">subsample</span><span class="p">(</span><span class="n">nsamples</span><span class="o">=</span><span class="n">ens_LMR</span><span class="o">.</span><span class="n">nEns</span><span class="p">)</span> <span class="c1"># downsample to the same ensemble size as LMRv2.1</span>
<span class="n">ens_mean</span> <span class="o">=</span> <span class="n">ens_o2000</span><span class="o">.</span><span class="n">get_mean</span><span class="p">()</span>
<span class="n">ens_d</span> <span class="o">=</span> <span class="n">ens_o2000</span> <span class="o">-</span> <span class="n">ens_mean</span>
<span class="n">ens_d</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">ens_o2000</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="s2">&quot; (centered)&quot;</span>
<span class="n">ens_d</span><span class="o">.</span><span class="n">plot_qs</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: title={&#39;center&#39;: &#39;LMR online (centered)&#39;}, xlabel=&#39;time&#39;, ylabel=&#39;value&#39;&gt;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_14_1.png" src="../_images/notebooks_eg24-Fig5_resampling_14_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PSD_o</span> <span class="o">=</span> <span class="n">ens_d</span><span class="o">.</span><span class="n">to_pyleo</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;mtm&#39;</span><span class="p">,</span><span class="n">settings</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;standardize&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">})</span> <span class="c1"># this generate a MultiplePSD object</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Performing spectral analysis on individual series: 100%|██████████| 2000/2000 [00:13&lt;00:00, 147.85it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PSD_oaa</span> <span class="o">=</span> <span class="n">PSD_o</span><span class="o">.</span><span class="n">anti_alias</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Applying the anti-alias filter: 100%|██████████| 2000/2000 [00:23&lt;00:00, 84.29it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PSD_oaa</span><span class="o">.</span><span class="n">plot_envelope</span><span class="p">(</span><span class="n">curve_clr</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span><span class="n">shade_clr</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 1000x400 with 1 Axes&gt;,
 &lt;Axes: xlabel=&#39;Period [years CE]&#39;, ylabel=&#39;PSD&#39;&gt;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_17_1.png" src="../_images/notebooks_eg24-Fig5_resampling_17_1.png" />
</div>
</div>
<p>The median spectrum is not so different from an AR(1) (the aliasing at periods shorter than ~3y can be ignored). Let’s extract it, add random phase, and invert it back to the time domain.</p>
<p>Let’s do this as in <a class="reference external" href="https://dsp.stackexchange.com/a/7703">this example</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">PSD_median</span> <span class="o">=</span> <span class="n">PSD_oaa</span><span class="o">.</span><span class="n">quantiles</span><span class="p">()</span><span class="o">.</span><span class="n">psd_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">amplitude</span>

<span class="n">nfrms</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">ens_o</span><span class="o">.</span><span class="n">nt</span><span class="o">//</span><span class="mi">2</span>
<span class="n">len_ser</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">nfrms</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">interv1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">len_ser</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">interv2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">len_ser</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">nfrms</span><span class="p">)</span>

<span class="n">median_ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nfrms</span><span class="p">))</span>
<span class="n">ph_rnd</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">nfrms</span><span class="p">)</span> <span class="c1"># random phases</span>

<span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nfrms</span><span class="p">))</span>
<span class="n">magnitude</span><span class="p">[</span><span class="n">interv1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">PSD_median</span><span class="p">[</span><span class="n">interv1</span><span class="p">])</span>
<span class="n">magnitude</span><span class="p">[</span><span class="n">interv2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">magnitude</span><span class="p">[</span><span class="n">interv1</span><span class="p">])</span>
<span class="c1"># Create the random phases for all the time series</span>
<span class="n">FFT</span> <span class="o">=</span> <span class="n">magnitude</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">ph_rnd</span><span class="p">)</span>
<span class="c1">#ph_interv2 = np.conj(np.flipud(ph_interv1))</span>

<span class="c1"># Inverse transform</span>
<span class="n">median_ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">FFT</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">median_ts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x17bbee8d0&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_20_1.png" src="../_images/notebooks_eg24-Fig5_resampling_20_1.png" />
</div>
</div>
<p>Let’s fit an autoregressive model to this series:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">median_ts</span>
<span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">tsaplots</span><span class="o">.</span><span class="n">plot_acf</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_22_0.png" src="../_images/notebooks_eg24-Fig5_resampling_22_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_22_1.png" src="../_images/notebooks_eg24-Fig5_resampling_22_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.ar_model</span> <span class="kn">import</span> <span class="n">AutoReg</span>
<span class="n">max_lag</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">ar_mod</span> <span class="o">=</span> <span class="n">AutoReg</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">max_lag</span><span class="p">)</span>
<span class="n">ar_res</span> <span class="o">=</span> <span class="n">ar_mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;HAC&#39;</span><span class="p">,</span> <span class="n">cov_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;maxlags&#39;</span><span class="p">:</span> <span class="n">max_lag</span><span class="p">})</span>  <span class="c1"># Heteroskedasticity-autocorrelation robust covariance estimation.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ar_res</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                            AutoReg Model Results
==============================================================================
Dep. Variable:                      y   No. Observations:                 1001
Model:                    AutoReg(15)   Log Likelihood                4942.711
Method:               Conditional MLE   S.D. of innovations              0.002
Date:                Fri, 16 Aug 2024   AIC                          -9851.422
Time:                        11:37:38   BIC                          -9768.229
Sample:                            15   HQIC                         -9819.781
                                 1001
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const       5.562e-06   5.04e-05      0.110      0.912   -9.33e-05       0.000
y.L1           0.6878      0.032     21.785      0.000       0.626       0.750
y.L2           0.1323      0.037      3.567      0.000       0.060       0.205
y.L3          -0.0259      0.039     -0.659      0.510      -0.103       0.051
y.L4           0.0137      0.038      0.360      0.719      -0.061       0.088
y.L5           0.0093      0.033      0.285      0.776      -0.055       0.073
y.L6           0.0629      0.041      1.539      0.124      -0.017       0.143
y.L7          -0.0240      0.036     -0.673      0.501      -0.094       0.046
y.L8          -0.0443      0.032     -1.378      0.168      -0.107       0.019
y.L9           0.0657      0.034      1.923      0.055      -0.001       0.133
y.L10         -0.0207      0.040     -0.522      0.602      -0.099       0.057
y.L11         -0.0372      0.042     -0.879      0.379      -0.120       0.046
y.L12          0.0067      0.035      0.192      0.848      -0.062       0.075
y.L13          0.0282      0.041      0.689      0.491      -0.052       0.109
y.L14         -0.0665      0.039     -1.711      0.087      -0.143       0.010
y.L15          0.0653      0.032      2.016      0.044       0.002       0.129
                                    Roots
==============================================================================
                   Real          Imaginary           Modulus         Frequency
------------------------------------------------------------------------------
AR.1            -1.1430           -0.2643j            1.1732           -0.4638
AR.2            -1.1430           +0.2643j            1.1732            0.4638
AR.3            -0.9598           -0.7356j            1.2093           -0.3959
AR.4            -0.9598           +0.7356j            1.2093            0.3959
AR.5            -0.5056           -1.0411j            1.1574           -0.3220
AR.6            -0.5056           +1.0411j            1.1574            0.3220
AR.7             0.0299           -1.2653j            1.2656           -0.2462
AR.8             0.0299           +1.2653j            1.2656            0.2462
AR.9             1.0905           -0.0000j            1.0905           -0.0000
AR.10            1.1538           -0.3350j            1.2015           -0.0450
AR.11            1.1538           +0.3350j            1.2015            0.0450
AR.12            0.8933           -0.8168j            1.2104           -0.1179
AR.13            0.8933           +0.8168j            1.2104            0.1179
AR.14            0.4951           -1.1369j            1.2400           -0.1846
AR.15            0.4951           +1.1369j            1.2400            0.1846
------------------------------------------------------------------------------
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">ar_res</span><span class="o">.</span><span class="n">plot_diagnostics</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">max_lag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_24_0.png" src="../_images/notebooks_eg24-Fig5_resampling_24_0.png" />
</div>
</div>
<p>An excellent fit, except for some of the more extreme values. Let’s see what AR order is being determined automatically. From the CIs on coefficients, it looks like 2-4 would be a good choice:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod_sel</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">ar_model</span><span class="o">.</span><span class="n">ar_select_order</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">maxlag</span><span class="o">=</span><span class="n">max_lag</span><span class="p">)</span>
<span class="n">ar_order</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mod_sel</span><span class="o">.</span><span class="n">ar_lags</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;retained AR order: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ar_order</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
retained AR order: 2
</pre></div></div>
</div>
<p>AR(2) it is. All we need to do now is pass those parameters to the <code class="docutils literal notranslate"><span class="pre">._random_paths()</span></code> function in <code class="docutils literal notranslate"><span class="pre">pens</span></code> to simulate sensible trajectories. Before we do so, let us obtain the distribution of AR parameters from the ensemble:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ar_mod</span> <span class="o">=</span> <span class="n">AutoReg</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ar_order</span><span class="p">)</span>
<span class="n">ar_res2</span> <span class="o">=</span> <span class="n">ar_mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;maxlags&#39;</span><span class="p">:</span> <span class="n">ar_order</span><span class="p">})</span>  <span class="c1"># Heteroskedasticity-autocorrelation robust covariance estimation.</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">ar_res2</span><span class="o">.</span><span class="n">plot_diagnostics</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">max_lag</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AR(</span><span class="si">{</span><span class="n">ar_order</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">) fit to LMRonline median residual spectrum&#39;</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 0.98, &#39;AR(2) fit to LMRonline median residual spectrum&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_28_1.png" src="../_images/notebooks_eg24-Fig5_resampling_28_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../figures/LMRonline_AR2fit.pdf&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">ens_d</span><span class="o">.</span><span class="n">nEns</span><span class="p">,</span><span class="n">ar_order</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ens_d</span><span class="o">.</span><span class="n">nEns</span><span class="p">):</span>
    <span class="n">ts_mod</span> <span class="o">=</span> <span class="n">AutoReg</span><span class="p">(</span><span class="n">ens_d</span><span class="o">.</span><span class="n">value</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">ar_order</span><span class="p">)</span> <span class="c1"># set up the model</span>
    <span class="n">ts_res</span> <span class="o">=</span> <span class="n">ts_mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;HAC&#39;</span><span class="p">,</span> <span class="n">cov_kwds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;maxlags&#39;</span><span class="p">:</span> <span class="n">ar_order</span><span class="p">})</span>  <span class="c1"># Heteroskedasticity-autocorrelation robust covariance estimation.</span>
    <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">ts_res</span><span class="o">.</span><span class="n">params</span> <span class="c1"># export estimated parameters</span>
</pre></div>
</div>
</div>
<p>Now let us plot the estimated parameters:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">ymax</span> <span class="o">=</span> <span class="mi">25</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">phi</span><span class="p">[:,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;KDE over trajectories&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\hat{\phi}_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;$&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AR(</span><span class="si">{</span><span class="n">ar_order</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">) fit to detrended LMR online GMST&#39;</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 0.98, &#39;AR(2) fit to detrended LMR online GMST&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_32_1.png" src="../_images/notebooks_eg24-Fig5_resampling_32_1.png" />
</div>
</div>
<p>This confirms that only the first 2 AR coefficients are appreciably different from 0 in most ensemble members, so an AR(2) fit is warranted. Let us compute the mean coefficients:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phi_o</span> <span class="o">=</span> <span class="n">ar_res2</span><span class="o">.</span><span class="n">params</span>
<span class="nb">print</span><span class="p">(</span><span class="n">phi_o</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1.97704197e-06 6.87489909e-01 1.43084211e-01]
</pre></div></div>
</div>
</section>
<section id="Resampling-the-offline-LMR">
<h2>Resampling the offline LMR<a class="headerlink" href="#Resampling-the-offline-LMR" title="Link to this heading">#</a></h2>
<p>We now return to our original offline DA ensemble and try 3 timeseries models: - an autoregressive model (AR(2)) - fractional Gaussian noise (fGn) - power-law behavior</p>
<p>The target spectrum is the median of the distribution of detrended, standardized LMRonline spectra:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PSD_oaa_beta</span>  <span class="o">=</span> <span class="n">PSD_oaa</span><span class="o">.</span><span class="n">quantiles</span><span class="p">(</span><span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">])</span><span class="o">.</span><span class="n">beta_est</span><span class="p">()</span>
<span class="n">PSD_oaa_beta</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">beta_o</span> <span class="o">=</span> <span class="n">PSD_oaa_beta</span><span class="o">.</span><span class="n">beta_est_res</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">beta_o</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9278696644415955
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_36_1.png" src="../_images/notebooks_eg24-Fig5_resampling_36_1.png" />
</div>
</div>
<section id="AR-resampling">
<h3>AR resampling<a class="headerlink" href="#AR-resampling" title="Link to this heading">#</a></h3>
<p>We start with an autoregressive model Because such models are stationary by construction, they cannot generate increasing variance back in time. We solve this problem (internally) by scaling the simulated AR series to unit variance, then rescaling it by the ensemble standard deviation. The result is here:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">paths_ar</span> <span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">random_paths</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;ar&#39;</span><span class="p">,</span><span class="n">param</span><span class="o">=</span><span class="n">phi_o</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">plot_hdi</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;silver&#39;</span><span class="p">,</span> <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">paths_ar</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">,</span><span class="n">num_traces</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ens_LMR</span><span class="o">.</span><span class="n">get_mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\hat{\mu}(t)$&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;, AR(2) resampling&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 2000/2000 [00:00&lt;00:00, 4466.85it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x17c87ec90&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_38_2.png" src="../_images/notebooks_eg24-Fig5_resampling_38_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">get_std</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;original ensemble&#39;</span><span class="p">)</span>
<span class="n">paths_ar</span><span class="o">.</span><span class="n">get_std</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;AR(2) resampling&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Ensemble standard deviation&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x17cc4bb10&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_39_1.png" src="../_images/notebooks_eg24-Fig5_resampling_39_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ar_ts</span> <span class="o">=</span> <span class="n">paths_ar</span><span class="o">.</span><span class="n">to_pyleo</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">PSD_ar</span> <span class="o">=</span> <span class="n">ar_ts</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;mtm&#39;</span><span class="p">,</span><span class="n">settings</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;standardize&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Performing spectral analysis on individual series: 100%|██████████| 2000/2000 [00:21&lt;00:00, 94.20it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PSD_ar_aa</span> <span class="o">=</span> <span class="n">PSD_ar</span><span class="o">.</span><span class="n">anti_alias</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Applying the anti-alias filter: 100%|██████████| 2000/2000 [00:36&lt;00:00, 54.10it/s]
</pre></div></div>
</div>
<p>With 5000 ensemble members, we see that the AR(2) resampled ensemble achieves a sample standard deviation very close to the original, as must be the case by construction.</p>
</section>
<section id="Power-law-scaling">
<h3>Power law scaling<a class="headerlink" href="#Power-law-scaling" title="Link to this heading">#</a></h3>
<p>The last option is power-law scaling, enabled by the <a class="reference external" href="https://stochastic.readthedocs.io/">stochastic package</a>. Note that under certain conditions (<span class="math notranslate nohighlight">\(\beta = 2H-1, H&lt;1\)</span>), results are equivalent with fGn and the power law option.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">paths_pl</span> <span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">random_paths</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;power-law&#39;</span><span class="p">,</span><span class="n">param</span><span class="o">=</span><span class="n">beta_o</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">plot_hdi</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;silver&#39;</span><span class="p">,</span> <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">paths_pl</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:purple&#39;</span><span class="p">,</span> <span class="n">num_traces</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ens_LMR</span><span class="o">.</span><span class="n">get_mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\hat{\mu}(t)$&#39;</span><span class="p">,</span>
                        <span class="n">title</span><span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;, $f^{-\beta}$ resampling, &#39;</span> <span class="o">+</span> <span class="sa">fr</span><span class="s1">&#39;$\beta = </span><span class="si">{</span><span class="n">beta_o</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 2000/2000 [00:02&lt;00:00, 696.88it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x1c41f2510&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_44_2.png" src="../_images/notebooks_eg24-Fig5_resampling_44_2.png" />
</div>
</div>
<p>This indeed looks very similar to the fGn case. In addition, this option enables to simulate longer-memory behavior with exponents steeper than unity. For instance:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">beta</span> <span class="o">=</span> <span class="mf">1.2</span>
<span class="n">paths_pl2</span> <span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">random_paths</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;power-law&#39;</span><span class="p">,</span><span class="n">param</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">plot_qs</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;silver&#39;</span><span class="p">)</span>
<span class="n">paths_pl2</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:purple&#39;</span><span class="p">,</span> <span class="n">num_traces</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ens_LMR</span><span class="o">.</span><span class="n">get_mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;, $f^{-\beta}$ resampling, &#39;</span> <span class="o">+</span> <span class="sa">fr</span><span class="s1">&#39;$\beta = </span><span class="si">{</span><span class="n">beta</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">$)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 2000/2000 [00:02&lt;00:00, 784.53it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: title={&#39;center&#39;: &#39;LMR v2.1, $f^{-\\beta}$ resampling, $\\beta = 1.20$)&#39;}, xlabel=&#39;time&#39;, ylabel=&#39;GMST [°C]&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_46_2.png" src="../_images/notebooks_eg24-Fig5_resampling_46_2.png" />
</div>
</div>
<p>However, for <span class="math notranslate nohighlight">\(\beta &gt; 1\)</span> the process is no longer stationary, which causes issues with modeling its covariance, for instance.</p>
<p>And as before, ensemble spread is preserved:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">get_std</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;original ensemble&#39;</span><span class="p">)</span>
<span class="n">paths_pl</span><span class="o">.</span><span class="n">get_std</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:purple&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;power-law resampling&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Ensemble standard deviation&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x1c2d6e810&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_49_1.png" src="../_images/notebooks_eg24-Fig5_resampling_49_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pl_ts</span> <span class="o">=</span> <span class="n">paths_pl</span><span class="o">.</span><span class="n">to_pyleo</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">PSD_pl</span> <span class="o">=</span> <span class="n">pl_ts</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;mtm&#39;</span><span class="p">,</span><span class="n">settings</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;standardize&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">})</span>
<span class="n">PSD_pl_aa</span> <span class="o">=</span> <span class="n">PSD_pl</span><span class="o">.</span><span class="n">anti_alias</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Performing spectral analysis on individual series: 100%|██████████| 2000/2000 [00:23&lt;00:00, 86.19it/s]
Applying the anti-alias filter: 100%|██████████| 2000/2000 [00:42&lt;00:00, 47.48it/s]
</pre></div></div>
</div>
</section>
<section id="fGn-resampling">
<h3>fGn resampling<a class="headerlink" href="#fGn-resampling" title="Link to this heading">#</a></h3>
<p>fractional Gaussian noise was popularized by Mandelbrot &amp; Van Ness (1963) and is useful for modeling self-similar, long-memory processes. It has been abundantly used in hydrology, and is increasingly used for modeling GMST as well (see Frederiksen &amp; Rypdal, 2017). (more background from Frederi would be helpful here)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hurst</span> <span class="o">=</span> <span class="p">(</span><span class="n">beta_o</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="n">paths_fGn</span> <span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">random_paths</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;fGn&#39;</span><span class="p">,</span><span class="n">param</span><span class="o">=</span><span class="n">hurst</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">plot_hdi</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;silver&#39;</span><span class="p">,</span> <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">paths_fGn</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span><span class="n">num_traces</span> <span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ens_LMR</span><span class="o">.</span><span class="n">get_mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\hat{\mu}(t)$&#39;</span><span class="p">,</span>
                        <span class="n">title</span><span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="sa">fr</span><span class="s1">&#39;, fGn resampling, $H = </span><span class="si">{</span><span class="n">hurst</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 2000/2000 [00:00&lt;00:00, 2240.50it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x179a66250&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_52_2.png" src="../_images/notebooks_eg24-Fig5_resampling_52_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">get_std</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;original ensemble&#39;</span><span class="p">)</span>
<span class="n">paths_fGn</span><span class="o">.</span><span class="n">get_std</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fGn resampling&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Ensemble standard deviation&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x17c9be8d0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_53_1.png" src="../_images/notebooks_eg24-Fig5_resampling_53_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fGn_ts</span> <span class="o">=</span> <span class="n">paths_fGn</span><span class="o">.</span><span class="n">to_pyleo</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">PSD_fGn</span> <span class="o">=</span> <span class="n">fGn_ts</span><span class="o">.</span><span class="n">spectral</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;mtm&#39;</span><span class="p">,</span><span class="n">settings</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;standardize&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">})</span>
<span class="n">PSD_fGn_aa</span> <span class="o">=</span> <span class="n">PSD_fGn</span><span class="o">.</span><span class="n">anti_alias</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Performing spectral analysis on individual series: 100%|██████████| 2000/2000 [00:23&lt;00:00, 85.49it/s]
Applying the anti-alias filter: 100%|██████████| 2000/2000 [00:39&lt;00:00, 50.36it/s]
</pre></div></div>
</div>
<p>Finally, we summarize on a single figure:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="c1"># AR resampling</span>
<span class="n">ens_LMR</span><span class="o">.</span><span class="n">plot_hdi</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;silver&#39;</span><span class="p">,</span> <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">paths_ar</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">,</span>
                     <span class="n">lgd_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">},</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ens_LMR</span><span class="o">.</span><span class="n">get_mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\hat{\mu}(t)$&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;a) &#39;</span> <span class="o">+</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="s1">&#39;, AR(2) resampling&#39;</span><span class="p">,</span>
                 <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="c1"># fGn</span>
<span class="n">ens_LMR</span><span class="o">.</span><span class="n">plot_hdi</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;silver&#39;</span><span class="p">,</span> <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">paths_fGn</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span>
                      <span class="n">lgd_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">},</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ens_LMR</span><span class="o">.</span><span class="n">get_mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\hat{\mu}(t)$&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;b) &#39;</span> <span class="o">+</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="sa">fr</span><span class="s1">&#39;, fGn resampling, $H = </span><span class="si">{</span><span class="n">hurst</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">,</span>
                 <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="c1"># power law</span>
<span class="n">ens_LMR</span><span class="o">.</span><span class="n">plot_hdi</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;silver&#39;</span><span class="p">,</span> <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">paths_pl</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:purple&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="n">lgd_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">})</span>
<span class="n">ens_LMR</span><span class="o">.</span><span class="n">get_mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\hat{\mu}(t)$&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;c) &#39;</span> <span class="o">+</span> <span class="n">ens_LMR</span><span class="o">.</span><span class="n">label</span> <span class="o">+</span> <span class="sa">fr</span><span class="s1">&#39;, power law resampling, $\beta = </span><span class="si">{</span><span class="n">beta_o</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">,</span>
                 <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [yrs]&#39;</span><span class="p">)</span>
<span class="c1"># spectra</span>
<span class="n">PSD_ar_aa</span><span class="o">.</span><span class="n">plot_envelope</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">members_plot_num</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;d) Spectral effects&#39;</span><span class="p">,</span>
                 <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">PSD_fGn_aa</span><span class="o">.</span><span class="n">plot_envelope</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">members_plot_num</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">curve_clr</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">shade_clr</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">)</span>
<span class="n">PSD_pl_aa</span><span class="o">.</span><span class="n">plot_envelope</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">members_plot_num</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">curve_clr</span><span class="o">=</span><span class="s1">&#39;tab:purple&#39;</span><span class="p">,</span> <span class="n">shade_clr</span><span class="o">=</span><span class="s1">&#39;tab:purple&#39;</span><span class="p">)</span>
<span class="c1"># plot median</span>
<span class="c1">#esm_rnd = ens_o2000.get_median()</span>
<span class="c1">#esm_rnd = esm_rnd.to_pyleo()</span>
<span class="c1">#esm_rnd_spec = esm_rnd.spectral(method =&#39;mtm&#39;,settings={&#39;standardize&#39;:False})</span>
<span class="c1">#esm_rnd_beta = esm_rnd_spec.anti_alias().beta_est() # estimate spectral exponent</span>
<span class="c1">#esm_rnd_beta.plot(ax=axs[3], ylabel=&#39;PSD&#39;, xlabel = &#39;period [yrs]&#39;)</span>
<span class="n">PSD_oaa_beta</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;PSD&#39;</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;period [yrs]&#39;</span><span class="p">,</span>
                  <span class="n">colors</span> <span class="o">=</span> <span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
<span class="n">h</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">hdls</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">lbls</span> <span class="o">=</span><span class="p">[]</span>
<span class="n">hdls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">lbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;a)&#39;</span><span class="p">)</span>
<span class="n">hdls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span> <span class="n">lbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;b)&#39;</span><span class="p">)</span>
<span class="n">hdls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span> <span class="n">lbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;c)&#39;</span><span class="p">)</span>
<span class="n">hdls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">6</span><span class="p">]);</span> <span class="n">lbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;LMRonline median&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">hdls</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span> <span class="n">lbls</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig5_resampling_56_0.png" src="../_images/notebooks_eg24-Fig5_resampling_56_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../figures/Fig5_resampling.pdf&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Conclusion">
<h2>Conclusion<a class="headerlink" href="#Conclusion" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pens</span></code> now has 4 options for resampling the posterior ensemble of offline DA methods: 1 non-parametric method and 3 parametric ones – all distribution-preserving. As we show in the paper, naive resampling is deeply problematic, so a parametric model is necessary. However, the choice of model is subjective, and the choice of parameter requires somewhat careful thinking, so we refrain from providing one-size-fits-all defaults that would encourage users to rely on general recipes that may not
apply to the case at hand.</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="eg24-Fig3_4_LMRonline.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Making Figures 3 &amp; 4</p>
      </div>
    </a>
    <a class="right-next"
       href="eg24-Fig6_8_plume_distance.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Proximity Probability and Plume Distance</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Independent-constraints-on-temporal-structure">Independent constraints on temporal structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Resampling-the-offline-LMR">Resampling the offline LMR</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#AR-resampling">AR resampling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Power-law-scaling">Power law scaling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fGn-resampling">fGn resampling</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Conclusion">Conclusion</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Author name not set
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Julien Emile-Geay, Feng Zhu.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>