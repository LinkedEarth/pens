
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>[Figs. 6-8] Proximity Probability and Plume Distance &#8212; pens  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=db61ab07" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=fca5bd30" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/eg24-Fig6_8_plume_distance';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="[Fig. 9] Schematic for the Plume Distance" href="eg24-Fig9_plume_distance-schematic.html" />
    <link rel="prev" title="[Fig. 5] Ensemble resampling" href="eg24-Fig5_resampling.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">pens  documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../ug-installation.html">Installation</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../ug-eg24.html">Emile-Geay et al. (2024)</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="eg24-Fig1_motivation.html">[Fig. 1] Motivation for the study</a></li>
<li class="toctree-l2"><a class="reference internal" href="eg24-Fig2_naive_resampling.html">[Fig. 2] Naïve sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="eg24-Fig3_4_LMRonline.html">[Figs. 3-4] LMRonline</a></li>
<li class="toctree-l2"><a class="reference internal" href="eg24-Fig5_resampling.html">[Fig. 5] Ensemble resampling</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">[Figs. 6-8] Proximity Probability and Plume Distance</a></li>
<li class="toctree-l2"><a class="reference internal" href="eg24-Fig9_plume_distance-schematic.html">[Fig. 9] Schematic for the Plume Distance</a></li>
<li class="toctree-l2"><a class="reference internal" href="eg24-Fig10_compare_PAGES2k2019_recons.html">[Fig. 10] Consistency of the PAGES 2k ensemble</a></li>
<li class="toctree-l2"><a class="reference internal" href="eg24-Fig11_12_compare_LMRvsB21.html">[Figs. 11-12] LMR v2.1 vs Büntgen et al ensemble</a></li>
<li class="toctree-l2"><a class="reference internal" href="eg24-Tab1_LMR_PMIP3_proximity_table.html">[Table 1] Proximity of PMIP3 traces to LMR ensembles</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../ug-api.html">API Reference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/fzhu2e/pens" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/fzhu2e/pens/edit/main/notebooks/eg24-Fig6_8_plume_distance.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/fzhu2e/pens/issues/new?title=Issue%20on%20page%20%2Fnotebooks/eg24-Fig6_8_plume_distance.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/eg24-Fig6_8_plume_distance.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>[Figs. 6-8] Proximity Probability and Plume Distance</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#PMIP3-past1000-runs-vs-LMRonline">PMIP3 past1000 runs vs LMRonline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#PMIP3-simulations">PMIP3 simulations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Pathwise-Approach-:-proximity-probability">Pathwise Approach : proximity probability</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Plume-distance">Plume distance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Definition">Definition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Mathematical-Properties-of-the-Plume-Distance">Mathematical Properties of the Plume Distance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Updated-Fig-7">Updated Fig 7</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Plume-to-plume-distance">Plume-to-plume distance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#LMRoffline-vs-LMRonline">LMRoffline vs LMRonline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#PMIP3-distances-to-LMRonline">PMIP3 distances to LMRonline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Illustrate-tube-around-HadCM3">Illustrate tube around HadCM3</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="[Figs.-6-8]-Proximity-Probability-and-Plume-Distance">
<h1>[Figs. 6-8] Proximity Probability and Plume Distance<a class="headerlink" href="#[Figs.-6-8]-Proximity-Probability-and-Plume-Distance" title="Link to this heading">#</a></h1>
<p>This notebook explores a framework to assess the probability of observing a climate trace within an ensemble of trajectories, or observing one ensemble given another. The intended applications are to assess :</p>
<ul class="simple">
<li><p>how distant/conflicting several reconstructions are from one another</p></li>
<li><p>how (in)compatible model simulations may be compared to a give reconstruction ensemble</p></li>
</ul>
<p>Previous attempts using the likelihood (a density of proability) and parametric models have failed to produce robust and numerically sensible results. Here we go back to the drawing board and implement a new method.</p>
<p>The idea is to give oneself a tube of size <span class="math notranslate nohighlight">\(\epsilon\)</span> and shape given by the norm <span class="math notranslate nohighlight">\(q\)</span> (circular section for the 2-norm, diamond section for the 1 norm, “Philips head” for the infinity norm). One simply enumerates the number of ensemble trajectories that fit within <span class="math notranslate nohighlight">\(\epsilon\)</span> of the target. Given an ensemble <span class="math notranslate nohighlight">\(X\)</span> of trajectories, we proceed as follows: 1. compute the <span class="math notranslate nohighlight">\(q\)</span>-norm distance between a trace <span class="math notranslate nohighlight">\(y\)</span> and the <code class="docutils literal notranslate"><span class="pre">nEns</span></code> ensemble members. 2. graph the
distribution of distances <span class="math notranslate nohighlight">\(d_q(y,X) = \lVert y-X \rVert_q\)</span> to choose a sensible range of <span class="math notranslate nohighlight">\(\epsilon\)</span> parameters 3. Compute the proximity probability <span class="math notranslate nohighlight">\(\mathbb{P}(d_q(y,X) \le \epsilon)\)</span> as the proportion of ensemble members that fit within the tube for a given set of <span class="math notranslate nohighlight">\(\epsilon\)</span> parameters. 4. Graph this proportion as a function of <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p>
<p>We can use this distribution to define simple, robust statistics of distance.</p>
<p>The notebook reproduces Figs 6-9 of the paper.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="kn">import</span> <span class="nn">pens</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
<span class="n">pens</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;journal_nogrid&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="PMIP3-past1000-runs-vs-LMRonline">
<h2>PMIP3 past1000 runs vs LMRonline<a class="headerlink" href="#PMIP3-past1000-runs-vs-LMRonline" title="Link to this heading">#</a></h2>
<p>First, we focus on assessing these probabilities for the HadCM3 and CCSM4 past1000 GMST traces and their proximity to the LMRonline ensemble:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ens_on</span> <span class="o">=</span> <span class="n">pens</span><span class="o">.</span><span class="n">EnsembleTS</span><span class="p">()</span><span class="o">.</span><span class="n">load_nc</span><span class="p">(</span><span class="s1">&#39;../data/gmt_MCruns_ensemble_full_LMRonline.nc&#39;</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s1">&#39;glob_mean&#39;</span><span class="p">,</span> <span class="n">time_name</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">)</span>
<span class="n">ens_on</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;LMR online&#39;</span>
<span class="n">ens_on</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="s1">&#39;years&#39;</span>
<span class="n">ens_on</span><span class="o">.</span><span class="n">time_name</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>            <span class="c1"># optional metadata: the name of the time axis</span>
<span class="n">ens_on</span><span class="o">.</span><span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;GMST&#39;</span><span class="p">,</span>     <span class="c1"># optional metadata: the name of the value axis</span>
<span class="n">ens_on</span><span class="o">.</span><span class="n">value_unit</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\N{DEGREE SIGN}</span><span class="s1">C&#39;</span><span class="p">,</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">plot_qs</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;tab:gray&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig6_8_plume_distance_3_0.png" src="../_images/notebooks_eg24-Fig6_8_plume_distance_3_0.png" />
</div>
</div>
<p>In such a representation, it is evident that, as the estimation becomes more uncertain back in time (due to data attrition in this case), the median shows less temporal variability. Conversely, while the ensemble converges around the median after 1500 CE, the median shows more temporal structure. The lack of such structure in the first millennium CE has been commented on (e.g. by Büntgen et al, 2020), with the claim assertion that it “lacks variability”, as opposed to e.g. transient simulations
with General Circulation Models (GCMs), like that from HadCM3.</p>
<p>We first show that such an ensemble is in fact compatible with that simulation, in the sense that one can find an arbitrarily close trajectory within the ensemble that approximates the target.</p>
</section>
<section id="PMIP3-simulations">
<h2>PMIP3 simulations<a class="headerlink" href="#PMIP3-simulations" title="Link to this heading">#</a></h2>
<p>Let us load and plot the data first:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">&#39;../data/PMIP3_GMST.txt&#39;</span><span class="p">)</span>
<span class="c1"># create a new pandas.DataFrame to store the processed data</span>
<span class="n">dfn</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># remove the data columns for CESM and GISS ensemble members</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">dfn</span> <span class="o">=</span> <span class="n">dfn</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;CESM_member_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">dfn</span> <span class="o">=</span> <span class="n">dfn</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;GISS-E2-R_r1i1p127.1&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dfn</span> <span class="o">=</span> <span class="n">dfn</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;GISS-E2-R_r1i1p127&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dfn</span> <span class="o">=</span> <span class="n">dfn</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;GISS-E2-R_r1i1p121&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># calculate the ensemble mean for CESM and GISS, and add the results into the table</span>
<span class="n">dfn</span><span class="p">[</span><span class="s1">&#39;CESM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span>
    <span class="s1">&#39;CESM_member_1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CESM_member_2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CESM_member_3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CESM_member_4&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CESM_member_5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CESM_member_6&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CESM_member_7&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CESM_member_8&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CESM_member_9&#39;</span><span class="p">,</span>
    <span class="s1">&#39;CESM_member_10&#39;</span><span class="p">,</span>
<span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">dfn</span><span class="p">[</span><span class="s1">&#39;GISS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span>
    <span class="s1">&#39;GISS-E2-R_r1i1p127.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GISS-E2-R_r1i1p127&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GISS-E2-R_r1i1p121&#39;</span><span class="p">,</span>
<span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># display the processed data</span>
<span class="n">dfn</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>bcc_csm1_1</th>
      <th>CCSM4</th>
      <th>FGOALS_gl</th>
      <th>FGOALS_s2</th>
      <th>IPSL_CM5A_LR</th>
      <th>MPI_ESM_P</th>
      <th>CSIRO</th>
      <th>HadCM3</th>
      <th>CESM</th>
      <th>GISS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>850</td>
      <td>-0.570693</td>
      <td>-0.431830</td>
      <td>NaN</td>
      <td>-0.620995</td>
      <td>-0.475963</td>
      <td>-0.170230</td>
      <td>NaN</td>
      <td>-0.620517</td>
      <td>0.049553</td>
      <td>0.127429</td>
    </tr>
    <tr>
      <th>1</th>
      <td>851</td>
      <td>-0.698903</td>
      <td>-0.411177</td>
      <td>NaN</td>
      <td>-0.753160</td>
      <td>-0.742970</td>
      <td>-0.303124</td>
      <td>-0.398695</td>
      <td>-0.553043</td>
      <td>0.193858</td>
      <td>0.138796</td>
    </tr>
    <tr>
      <th>2</th>
      <td>852</td>
      <td>-0.575440</td>
      <td>-0.404802</td>
      <td>NaN</td>
      <td>-0.743508</td>
      <td>-0.758939</td>
      <td>-0.422623</td>
      <td>-0.406343</td>
      <td>-0.560791</td>
      <td>0.185033</td>
      <td>0.098170</td>
    </tr>
    <tr>
      <th>3</th>
      <td>853</td>
      <td>-0.724757</td>
      <td>-0.552719</td>
      <td>NaN</td>
      <td>-0.869331</td>
      <td>-0.746460</td>
      <td>-0.335177</td>
      <td>-0.353557</td>
      <td>-0.438949</td>
      <td>0.120470</td>
      <td>-0.054552</td>
    </tr>
    <tr>
      <th>4</th>
      <td>854</td>
      <td>-0.724328</td>
      <td>-0.734938</td>
      <td>NaN</td>
      <td>-0.826238</td>
      <td>-0.684093</td>
      <td>-0.650792</td>
      <td>-0.416140</td>
      <td>-0.812194</td>
      <td>-0.081349</td>
      <td>-0.407169</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1161</th>
      <td>2011</td>
      <td>1.013544</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1162</th>
      <td>2012</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1163</th>
      <td>2013</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1164</th>
      <td>2014</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1165</th>
      <td>2015</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>1166 rows × 11 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># store each pyleoclim.Series() object into a dictionary and plot</span>
<span class="kn">import</span> <span class="nn">pyleoclim</span> <span class="k">as</span> <span class="nn">pyleo</span>
<span class="n">ts_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dfn</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">ts_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
        <span class="n">time</span><span class="o">=</span><span class="n">dfn</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  <span class="c1"># the time axis</span>
        <span class="n">value</span><span class="o">=</span><span class="n">dfn</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>   <span class="c1"># the value axis</span>
        <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>                  <span class="c1"># optional metadata: the nickname of the series</span>
        <span class="n">time_name</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>            <span class="c1"># optional metadata: the name of the time axis</span>
        <span class="n">time_unit</span><span class="o">=</span><span class="s1">&#39;yrs&#39;</span><span class="p">,</span>             <span class="c1"># optional metadata: the unit of the time axis</span>
        <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;GMST&#39;</span><span class="p">,</span>     <span class="c1"># optional metadata: the name of the value axis</span>
        <span class="n">value_unit</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\N{DEGREE SIGN}</span><span class="s1">C&#39;</span><span class="p">,</span>              <span class="c1"># optional metadata: the unit of the value axis</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">ts_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ts_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>  <span class="c1"># a pythonic way to convert the pyleo.Series items in the dictionary to a list</span>
<span class="n">ms_pmip</span> <span class="o">=</span> <span class="n">pyleo</span><span class="o">.</span><span class="n">MultipleSeries</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ms_pmip</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lgd_kwargs</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.25</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># move the legend to the right side</span>
    <span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig6_8_plume_distance_7_0.png" src="../_images/notebooks_eg24-Fig6_8_plume_distance_7_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">common_time</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">]</span>
<span class="n">HadCM3</span> <span class="o">=</span> <span class="n">ts_list</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">common_time</span><span class="p">)</span>
<span class="n">CCSM4</span> <span class="o">=</span> <span class="n">ts_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">common_time</span><span class="p">)</span>
<span class="n">path_nearest</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">sample_nearest</span><span class="p">(</span><span class="n">HadCM3</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;MSE&#39;</span><span class="p">)</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">path_nearest</span><span class="o">.</span><span class="n">distance</span>  <span class="c1"># extract distance metric</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">path_nearest</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Closest LMR match (MSE = </span><span class="si">{:4.3f}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Nearest LMR path&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">HadCM3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">common_time</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1000.0, 2000.0)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig6_8_plume_distance_8_1.png" src="../_images/notebooks_eg24-Fig6_8_plume_distance_8_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_match</span> <span class="o">=</span> <span class="n">path_nearest</span><span class="o">.</span><span class="n">to_pyleo</span><span class="p">()</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">ts_match</span><span class="o">.</span><span class="n">correlation</span><span class="p">(</span><span class="n">HadCM3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Time axis values sorted in ascending order
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Evaluating association on surrogate pairs: 100%|██████████| 1000/1000 [00:00&lt;00:00, 2963.05it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  correlation  p-value    signif. (α: 0.05)
-------------  ---------  -------------------
     0.991096  &lt; 1e-6     True

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<p>We were indeed able to find a trajectory that highly correlates with the target (<span class="math notranslate nohighlight">\(\hat{\rho} &gt; 0.99\)</span>). The question is: how <em>likely</em> is that trajectory under the ensemble’s distribution? How can we define a probability measure over this space, given the number of potential resamplings? For <span class="math notranslate nohighlight">\(n=2001\)</span> temporal samples and <span class="math notranslate nohighlight">\(m=2000\)</span> ensemble members, this number is <span class="math notranslate nohighlight">\(n^m\)</span>, which is astronomical. Can a probability still be defined without resorting to brute force?</p>
</section>
<section id="Pathwise-Approach-:-proximity-probability">
<h2>Pathwise Approach : proximity probability<a class="headerlink" href="#Pathwise-Approach-:-proximity-probability" title="Link to this heading">#</a></h2>
<p>Let’s plot the HadCM3 and CCSM4 past1000 GMST traces and vs the density of the LMRonline ensemble:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">line_density</span><span class="p">()</span>
<span class="n">HadCM3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">CCSM4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../figures/HadCM3_CCSM4_LMRonline_traces.pdf&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig6_8_plume_distance_12_0.png" src="../_images/notebooks_eg24-Fig6_8_plume_distance_12_0.png" />
</div>
</div>
<p>Visually, it is evident that HadCM3 is closer to LMRonline than CCSM4. Is this borne out by these metrics? Let us compute the distances between these traces and the ensemble, using different norms:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;HadCM3&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSM4&#39;</span><span class="p">]</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">),</span><span class="n">ens_on</span><span class="o">.</span><span class="n">nEns</span><span class="p">))</span>
<span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">mdl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">ordr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
        <span class="n">dist</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="n">ordr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">order_str</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\infty$&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">ordr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">mdl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="p">:],</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">mdl</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;distance ($\epsilon$)&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">order_str</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;-norm&#39;</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span> <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../figures/HadCM3_CCSM4_LMRonline_distance.pdf&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig6_8_plume_distance_15_0.png" src="../_images/notebooks_eg24-Fig6_8_plume_distance_15_0.png" />
</div>
</div>
<p>Indeed, HadCM3 is measurably closer. The results are qualitatively robust to the choice of norm, and surprisingly enough, nearly unchanged from <span class="math notranslate nohighlight">\(q=1\)</span> to <span class="math notranslate nohighlight">\(q=2\)</span>. These results may now guide the choice of <span class="math notranslate nohighlight">\(\epsilon\)</span> to compute a probability, e.g. a Cumulative Distribution Function (CDF). For instance with the 1-norm:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">mdl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
    <span class="n">prob</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">proximity_prob</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">prob</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="p">:],</span><span class="n">label</span><span class="o">=</span><span class="n">mdl</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Proximity threshold $\epsilon \, (</span><span class="si">{}</span><span class="s1">^\circ \mathrm</span><span class="si">{C}</span><span class="s1">)$ &#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathbb</span><span class="si">{P}</span><span class="s1">(d_1(y,X) &lt; \epsilon)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Proximity probability with respect to LMRonline GMST&quot;</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Proximity probability with respect to LMRonline GMST&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig6_8_plume_distance_17_1.png" src="../_images/notebooks_eg24-Fig6_8_plume_distance_17_1.png" />
</div>
</div>
<p>(results are nearly indistinguishable with the 2-norm).</p>
</section>
<section id="Plume-distance">
<h2>Plume distance<a class="headerlink" href="#Plume-distance" title="Link to this heading">#</a></h2>
<section id="Definition">
<h3>Definition<a class="headerlink" href="#Definition" title="Link to this heading">#</a></h3>
<p>From the CDFs obtained above, we would like to extract one metric that best summarizes the differences. In our tests, the shapes are very similar (abrupt climb for intermediate values of the proximity threshold), so a simple approach is to pick the difference between the values of epsilon for which these CDFs intersect <span class="math notranslate nohighlight">\(P = 0.5\)</span>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use this strategy for root finding: https://stackoverflow.com/a/46911822</span>
<span class="k">def</span> <span class="nf">find_roots</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="n">s</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">s</span><span class="p">]</span><span class="o">/</span><span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">s</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eps_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">eps_med</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">find_roots</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="p">:]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">eps_med</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">eps_med</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.2752498938114215
</pre></div></div>
</div>
<p>This metric suggests that HadCM3 is closer to LMRonline by about 0.27 degrees. (<span class="math notranslate nohighlight">\(\epsilon\)</span> has the same units as the variable of interest, in this case GMST). This is implemented as <code class="docutils literal notranslate"><span class="pre">plume_distance()</span></code> in <code class="docutils literal notranslate"><span class="pre">pens</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dist_HadCM3</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">plume_distance</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;HadCM3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">dist_CCSM4</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">plume_distance</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;CCSM4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">delta_eps</span> <span class="o">=</span>  <span class="n">dist_CCSM4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span>  <span class="n">dist_HadCM3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;$\Delta_\epsilon = </span><span class="si">{</span><span class="n">delta_eps</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
$\Delta_\epsilon = 0.2755582258356961$
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">yr</span> <span class="o">=</span> <span class="mf">0.55</span><span class="p">;</span> <span class="n">xr</span> <span class="o">=</span> <span class="mf">0.35</span>
<span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">mdl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
    <span class="n">prob</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">proximity_prob</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">prob</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="p">:],</span><span class="n">label</span><span class="o">=</span><span class="n">mdl</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xr</span><span class="o">-</span><span class="mf">.09</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yr</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$\Delta \epsilon_</span><span class="se">{{</span><span class="s1">50</span><span class="se">}}</span><span class="s1"> = $ </span><span class="si">{</span><span class="n">delta_eps</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">pa</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">FancyArrowPatch</span><span class="p">((</span><span class="mf">0.21</span><span class="p">,</span> <span class="mf">.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.49</span><span class="p">,</span> <span class="mf">.5</span><span class="p">),</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;|-|&gt;&#39;</span><span class="p">,</span> <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">pa</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Proximity threshold $\epsilon \, (</span><span class="si">{}</span><span class="s1">^\circ \mathrm</span><span class="si">{C}</span><span class="s1">)$ &#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathbb</span><span class="si">{P}</span><span class="s1">(d_1(y,X) &lt; \epsilon)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Plume distance with respect to LMRonline GMST&quot;</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../figures/HadCM3_CCSM4_LMRonline_plume_CDF.pdf&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig6_8_plume_distance_23_0.png" src="../_images/notebooks_eg24-Fig6_8_plume_distance_23_0.png" />
</div>
</div>
<p>There would be many other possible metrics: - maximum horizontal difference between the 2 curves (similar to the Kolmogorov-Smyrnov statistic for CDFs) - area between the two curves (harder to compute, and units are less intuitive).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">imax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Max distance = </span><span class="si">{</span><span class="n">e</span><span class="p">[</span><span class="n">imax</span><span class="p">]</span><span class="si">}</span><span class="s1">, prob = </span><span class="si">{</span><span class="n">prob</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">imax</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Max distance = 0.3606060606060606, prob = 0.004
</pre></div></div>
</div>
<p>This maximum distance falls at an extremely low probability, which seems arbitrary. The median seems a more justifiable choice, and a very easy one to implement. What are the properties of this newly defined metric?</p>
</section>
<section id="Mathematical-Properties-of-the-Plume-Distance">
<h3>Mathematical Properties of the Plume Distance<a class="headerlink" href="#Mathematical-Properties-of-the-Plume-Distance" title="Link to this heading">#</a></h3>
<p>Let us show that this verifies the conditions of a usual distance: - <em>The distance from an object to itself is zero</em>: it is trivially the case that if all the individual distances are 0, the distribution is a delta function centered at 0.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ens1</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">subsample</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span> <span class="c1"># subsample for computational convenience</span>
<span class="n">ens2</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">subsample</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<span class="n">d00</span> <span class="o">=</span> <span class="n">ens1</span><span class="o">.</span><span class="n">plume_distance</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ens1</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d00</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
objects are numerically identical
(0, 0.0)
</pre></div></div>
</div>
<p>More interesting is the case where thin subsets of the same ensemble are compared: the distance between two subsamples of the same plume will be small, but finite:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ens1</span><span class="o">.</span><span class="n">plume_distance</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ens2</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Computing inter-ensemble distance: 100%|██████████| 400/400 [00:00&lt;00:00, 1009.76it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(0.14142790802947053, 0.05058905937812187)
</pre></div></div>
</div>
<p>It tends to decrease as the ensemble size gets larger (better sampling of the full distribution):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ens1</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">subsample</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span> <span class="c1"># subsample for computational convenience</span>
<span class="n">ens2</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">subsample</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">ens1</span><span class="o">.</span><span class="n">plume_distance</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ens2</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Computing inter-ensemble distance: 100%|██████████| 2000/2000 [00:10&lt;00:00, 198.12it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(0.14160741602147853, 0.051939271665834175)
</pre></div></div>
</div>
<ul class="simple">
<li><p>(Positivity) <em>The distance between two distinct points is always positive</em>: trivial, as the metric can only pick <span class="math notranslate nohighlight">\(\epsilon\)</span> values that are positive-definite.</p></li>
<li><p>(Symmetry) <em>The distance from x to y is always the same as the distance from y to x</em></p></li>
</ul>
<p>Let’s compute this two ways and compare the result:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ens1</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">subsample</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span> <span class="c1"># subsample for computational convenience</span>
<span class="n">ens2</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">subsample</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<span class="n">d21</span> <span class="o">=</span> <span class="n">ens1</span><span class="o">.</span><span class="n">plume_distance</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ens2</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">d12</span> <span class="o">=</span> <span class="n">ens2</span><span class="o">.</span><span class="n">plume_distance</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ens1</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d21</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">d12</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Computing inter-ensemble distance: 100%|██████████| 400/400 [00:00&lt;00:00, 1014.00it/s]
Computing inter-ensemble distance: 100%|██████████| 400/400 [00:00&lt;00:00, 1022.20it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.0
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<ul class="simple">
<li><p>The triangle inequality holds <span class="math notranslate nohighlight">\(d(x, z) \leq d(x, y) + d(y, z)\)</span> (see Appendix)</p></li>
</ul>
</section>
</section>
<section id="Updated-Fig-7">
<h2>Updated Fig 7<a class="headerlink" href="#Updated-Fig-7" title="Link to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">ym</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">mdl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">mdl</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;silver&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">pa0</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">FancyArrowPatch</span><span class="p">((</span><span class="mf">0.21</span><span class="p">,</span> <span class="n">ym</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.49</span><span class="p">,</span> <span class="n">ym</span><span class="p">),</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;|-|&gt;&#39;</span><span class="p">,</span>
                              <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">pa0</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.34</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ym</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$\Delta \epsilon_</span><span class="se">{{</span><span class="s1">50</span><span class="se">}}</span><span class="s1"> = $ </span><span class="si">{</span><span class="n">delta_eps</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Proximity threshold $\epsilon \, (</span><span class="si">{}</span><span class="s1">^\circ \mathrm</span><span class="si">{C}</span><span class="s1">)$ &#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;a) Proximity density w.r.t LMRonline GMST&quot;</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">yr</span> <span class="o">=</span> <span class="mf">0.55</span><span class="p">;</span> <span class="n">xr</span> <span class="o">=</span> <span class="mf">0.35</span>
<span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">mdl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models</span><span class="p">):</span>
    <span class="n">prob</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">proximity_prob</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">prob</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="p">:],</span><span class="n">label</span><span class="o">=</span><span class="n">mdl</span><span class="p">)</span>  <span class="c1"># ,marker=&#39;o&#39;</span>
<span class="c1">#axs[1].legend()</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;silver&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xr</span><span class="o">-</span><span class="mf">.11</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yr</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;$\Delta \epsilon_</span><span class="se">{{</span><span class="s1">50</span><span class="se">}}</span><span class="s1"> = $ </span><span class="si">{</span><span class="n">delta_eps</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">pa1</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">FancyArrowPatch</span><span class="p">((</span><span class="mf">0.21</span><span class="p">,</span> <span class="mf">.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.49</span><span class="p">,</span> <span class="mf">.5</span><span class="p">),</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;|-|&gt;&#39;</span><span class="p">,</span> <span class="n">mutation_scale</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">pa1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Proximity threshold $\epsilon \, (</span><span class="si">{}</span><span class="s1">^\circ \mathrm</span><span class="si">{C}</span><span class="s1">)$ &#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathbb</span><span class="si">{P}</span><span class="s1">(d_1(y,X) &lt; \epsilon)$&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;b) Proximity probability (CDF)&quot;</span><span class="p">,</span> <span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../figures/Fig7_plume_distance.pdf&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig6_8_plume_distance_36_0.png" src="../_images/notebooks_eg24-Fig6_8_plume_distance_36_0.png" />
</div>
</div>
</section>
<section id="Plume-to-plume-distance">
<h2>Plume-to-plume distance<a class="headerlink" href="#Plume-to-plume-distance" title="Link to this heading">#</a></h2>
<section id="LMRoffline-vs-LMRonline">
<h3>LMRoffline vs LMRonline<a class="headerlink" href="#LMRoffline-vs-LMRonline" title="Link to this heading">#</a></h3>
<p>Let’s see how compatible LMRonline and LMRv2.1 (offline) are by this metric:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;../data/gmt_MCruns_ensemble_full_LMRv2.1.nc&#39;</span>
<span class="n">LMR</span> <span class="o">=</span> <span class="n">pens</span><span class="o">.</span><span class="n">EnsembleTS</span><span class="p">()</span><span class="o">.</span><span class="n">load_nc</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s1">&#39;gmt&#39;</span><span class="p">)</span>
<span class="n">ens_off</span>  <span class="o">=</span> <span class="n">LMR</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">common_time</span><span class="p">)</span>
<span class="n">ens_off</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;LMR v2.1&#39;</span>
<span class="n">ens_off</span><span class="o">.</span><span class="n">value_name</span> <span class="o">=</span> <span class="s1">&#39;GMST&#39;</span>
<span class="n">ens_off</span><span class="o">.</span><span class="n">value_unit</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\N{DEGREE SIGN}</span><span class="s1">C&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ens_o2000</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">subsample</span><span class="p">(</span><span class="n">nsamples</span><span class="o">=</span><span class="n">ens_off</span><span class="o">.</span><span class="n">nEns</span><span class="p">)</span>
<span class="n">LMR_on_off_dist</span> <span class="o">=</span> <span class="n">ens_o2000</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">ens_off</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">LMR_on_off_dist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Computing inter-ensemble distance: 100%|██████████| 2000/2000 [00:13&lt;00:00, 151.60it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: ylabel=&#39;Density&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig6_8_plume_distance_39_2.png" src="../_images/notebooks_eg24-Fig6_8_plume_distance_39_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LMR_on_off_plume_dist</span> <span class="o">=</span> <span class="n">ens_o2000</span><span class="o">.</span><span class="n">plume_distance</span><span class="p">(</span><span class="n">ens_off</span><span class="p">,</span><span class="n">dist</span><span class="o">=</span><span class="n">LMR_on_off_dist</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">LMR_on_off_plume_dist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Computing inter-ensemble distance: 100%|██████████| 2000/2000 [00:13&lt;00:00, 147.88it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(0.14314926587664106, 0.08246367512627469)
</pre></div></div>
</div>
<p>How notable is this difference? A natural point of comparison would be the distribution of <strong>intra-ensemble distances</strong>: the distances (in whatever norm , here <span class="math notranslate nohighlight">\(q=1\)</span>) between any two pairs of ensemble members. For an ensemble of size <span class="math notranslate nohighlight">\(N\)</span>, there are <span class="math notranslate nohighlight">\(N(N-1)/2\)</span> such pairs, so this can take a few seconds to compute):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LMRon_intra_dist</span> <span class="o">=</span> <span class="n">ens_o2000</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Computing intra-ensemble distance among possible pairs: 100%|██████████| 1999000/1999000 [00:05&lt;00:00, 354623.08it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">LMRon_intra_dist</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">hist_dist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">rv_histogram</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
<span class="n">hist_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mf">0.2752</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9621604593786395
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LMRoff_intra_dist</span> <span class="o">=</span> <span class="n">ens_off</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Computing intra-ensemble distance among possible pairs: 100%|██████████| 1999000/1999000 [00:10&lt;00:00, 197845.43it/s]
</pre></div></div>
</div>
<p>Now let’s plot these 3 quantities on the same graph (the plume distance is the dashed line):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LMRonline&#39;</span><span class="p">:</span> <span class="n">LMRon_intra_dist</span><span class="p">,</span> <span class="s1">&#39;LMR v2.1&#39;</span><span class="p">:</span> <span class="n">LMRoff_intra_dist</span><span class="p">}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">LMR_on_off_dist</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;silver&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">LMR_on_off_plume_dist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;plume distance&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.lines.Line2D at 0x3476015e0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig6_8_plume_distance_46_1.png" src="../_images/notebooks_eg24-Fig6_8_plume_distance_46_1.png" />
</div>
</div>
<p>We see that the plume distance falls between the intra-ensemble distances. The <code class="docutils literal notranslate"><span class="pre">LMRonline</span></code> distances are clustured relatively tigthly around 0.2, and are entirely encompassed by the much wider range of distances found in LMR2.1. This would argue for the ensembles being considered compatible with each other. Let us make sure this is not an artifact of the lack of temporal varaibility in individual traces in the LMR 2.1 (offline) ensemble. Let’s resample it according to a power law, as done in
the <code class="docutils literal notranslate"><span class="pre">resampling.ipynb</span></code> notebook:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ens_off_pl</span> <span class="o">=</span> <span class="n">ens_off</span><span class="o">.</span><span class="n">random_paths</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;power-law&#39;</span><span class="p">,</span><span class="n">param</span><span class="o">=</span><span class="mf">0.92</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 2000/2000 [00:00&lt;00:00, 2731.14it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LMRoff_pl_intra_dist</span> <span class="o">=</span> <span class="n">ens_off_pl</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Computing intra-ensemble distance among possible pairs: 100%|██████████| 1999000/1999000 [00:08&lt;00:00, 238234.22it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LMR_on_off_pl_dist</span> <span class="o">=</span> <span class="n">ens_o2000</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">ens_off_pl</span><span class="p">)</span>
<span class="n">LMR_on_off_pl_plume_dist</span> <span class="o">=</span> <span class="n">ens_o2000</span><span class="o">.</span><span class="n">plume_distance</span><span class="p">(</span><span class="n">ens_off_pl</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">LMR_on_off_pl_dist</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">LMR_on_off_pl_plume_dist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Computing inter-ensemble distance: 100%|██████████| 2000/2000 [00:14&lt;00:00, 138.14it/s]
Computing inter-ensemble distance: 100%|██████████| 2000/2000 [00:14&lt;00:00, 139.98it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(0.1632133968530639, 0.02783630604386758)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;LMRonline&#39;</span><span class="p">:</span> <span class="n">LMRon_intra_dist</span><span class="p">,</span> <span class="s1">&#39;LMR v2.1&#39;</span><span class="p">:</span> <span class="n">LMRoff_pl_intra_dist</span><span class="p">}</span>
<span class="n">df_pl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">LMRon_intra_dist</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LMRonline&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">LMRoff_intra_dist</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LMRv2.1&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">LMR_on_off_dist</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;on $\cap$ off&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;silver&#39;</span><span class="p">)</span>
<span class="n">plume</span> <span class="o">=</span> <span class="n">LMR_on_off_plume_dist</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">plume</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="sa">rf</span><span class="s1">&#39;$\Delta \epsilon_</span><span class="se">{{</span><span class="s1">50</span><span class="se">}}</span><span class="s1">=$</span><span class="si">{</span><span class="n">plume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">3.2f</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">plume</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">3.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;No resampling&#39;</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Proximity threshold $\epsilon \, (</span><span class="si">{}</span><span class="s1">^\circ \mathrm</span><span class="si">{C}</span><span class="s1">)$&#39;</span><span class="p">)</span>
<span class="c1"># with resampling</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">LMRon_intra_dist</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LMRonline&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">LMRoff_pl_intra_dist</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LMRv2.1 (resampled)&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">LMR_on_off_pl_dist</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;on $\cap$ off&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;silver&#39;</span><span class="p">)</span>
<span class="n">plume</span> <span class="o">=</span> <span class="n">LMR_on_off_pl_plume_dist</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">plume</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;silver&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="sa">rf</span><span class="s1">&#39;$\Delta \epsilon_</span><span class="se">{{</span><span class="s1">50</span><span class="se">}}</span><span class="s1">=$</span><span class="si">{</span><span class="n">plume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">3.2f</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">plume</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">3.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Power-law resampling&#39;</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Proximity threshold $\epsilon \, (</span><span class="si">{}</span><span class="s1">^\circ \mathrm</span><span class="si">{C}</span><span class="s1">)$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 0, &#39;Proximity threshold $\\epsilon \\, ({}^\\circ \\mathrm{C})$&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig6_8_plume_distance_51_1.png" src="../_images/notebooks_eg24-Fig6_8_plume_distance_51_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../figures/Fig8_LMR_on_off_distances.pdf&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The blue distribution is common to both plots. We can see that resampling has a dramatic effect on the intra-ensemble distribution (orange), and on the plume distance (dashed line) as well. It is therefore important to pick a sensible temporal model when assessing such distances. Now the roles are reversed: LMR2.1 sits within LMRonline, and the plume distance appears typical of LMRonline intra-ensemble distances, coinciding nearly perfectly with the mode of its distribution. I would conclude
that these two ensembles are mutually compatible.</p>
<p>Plot this on its own (for AGU 2023 talk)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;LMRonline&#39;</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="c1">#sns.histplot(LMRon_intra_dist, ax=ax, stat=&quot;density&quot;, kde=True, color=&#39;Silver&#39;)</span>
<span class="n">LMRon_q95</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">LMRon_intra_dist</span><span class="p">,</span><span class="mf">0.95</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">LMRon_q95</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">rf</span><span class="s1">&#39;$q_</span><span class="se">{{</span><span class="s1">95</span><span class="se">}}</span><span class="s1">=$</span><span class="si">{</span><span class="n">LMRon_q95</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;LMRonline intra-ensemble distances&#39;</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$d_1 (</span><span class="si">{}</span><span class="s1">^\circ$C)&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../figures/LMRonline_intra_dist.pdf&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig6_8_plume_distance_55_0.png" src="../_images/notebooks_eg24-Fig6_8_plume_distance_55_0.png" />
</div>
</div>
</section>
<section id="PMIP3-distances-to-LMRonline">
<h3>PMIP3 distances to LMRonline<a class="headerlink" href="#PMIP3-distances-to-LMRonline" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ms_pmip</span><span class="o">.</span><span class="n">series_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;label&#39;: &#39;FGOALS_gl&#39;}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
None
Time [yrs]
1000.0   -0.159104
1001.0   -0.498624
1002.0   -0.424599
1003.0   -0.261818
1004.0   -0.381586
            ...
1994.0    0.292927
1995.0    0.341958
1996.0    0.121402
1997.0    0.229942
1998.0    0.345065
Name: GMST [°C], Length: 999, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">common</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1998</span><span class="p">]</span> <span class="c1"># FGOALS is ruining it for everyone else.</span>
<span class="n">pmip3_plume_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ts_list</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ts</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ms_pmip</span><span class="o">.</span><span class="n">series_list</span><span class="p">):</span>
    <span class="n">ts_lm</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">common</span><span class="p">)</span>
    <span class="n">pmip3_plume_dist</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ens_on</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">common</span><span class="p">)</span><span class="o">.</span><span class="n">plume_distance</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ts_lm</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pmip3_plume_dist</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ens_off</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">common</span><span class="p">)</span><span class="o">.</span><span class="n">plume_distance</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ts_lm</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Model </span><span class="si">{</span><span class="n">ts</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> has distance </span><span class="si">{</span><span class="n">pmip3_plume_dist</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> to LMRonline&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Model </span><span class="si">{</span><span class="n">ts</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s1"> has distance </span><span class="si">{</span><span class="n">pmip3_plume_dist</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> to LMRv2.1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Model bcc_csm1_1 has distance 0.41122165184578463 to LMRonline
Model bcc_csm1_1 has distance 0.43061836299386946 to LMRv2.1
Model CCSM4 has distance 0.4924558270224748 to LMRonline
Model CCSM4 has distance 0.5127193275900492 to LMRv2.1
Model FGOALS_gl has distance 0.23326211990115073 to LMRonline
Model FGOALS_gl has distance 0.23476287690846337 to LMRv2.1
Model FGOALS_s2 has distance 0.978092246110303 to LMRonline
Model FGOALS_s2 has distance 1.0033572883855542 to LMRv2.1
Model IPSL_CM5A_LR has distance 0.6358790945189334 to LMRonline
Model IPSL_CM5A_LR has distance 0.6572388754183671 to LMRv2.1
Model MPI_ESM_P has distance 0.3489545292443897 to LMRonline
Model MPI_ESM_P has distance 0.3653459146799062 to LMRv2.1
Model CSIRO has distance 0.290704050192928 to LMRonline
Model CSIRO has distance 0.30436399229309186 to LMRv2.1
Model HadCM3 has distance 0.21652265207791915 to LMRonline
Model HadCM3 has distance 0.21430357496984626 to LMRv2.1
Model CESM has distance 0.14846731161092247 to LMRonline
Model CESM has distance 0.12467358616019808 to LMRv2.1
Model GISS has distance 0.29227668421737935 to LMRonline
Model GISS has distance 0.3096662656988495 to LMRv2.1
</pre></div></div>
</div>
<p>Export to a LaTeX table for the paper:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pmip3_plume_dist</span><span class="p">,</span>
                  <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LMRon&#39;</span><span class="p">,</span><span class="s1">&#39;LMRoff&#39;</span><span class="p">],</span>
                  <span class="n">columns</span><span class="o">=</span> <span class="n">dfn</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df_table</span><span class="o">.</span><span class="n">to_latex</span><span class="p">(</span><span class="n">formatters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">},</span> <span class="n">float_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
\begin{tabular}{lrrrrrrrrrr}
\toprule
 &amp; bcc_csm1_1 &amp; CCSM4 &amp; FGOALS_gl &amp; FGOALS_s2 &amp; IPSL_CM5A_LR &amp; MPI_ESM_P &amp; CSIRO &amp; HadCM3 &amp; CESM &amp; GISS \\
\midrule
LMRon &amp; 0.41 &amp; 0.49 &amp; 0.23 &amp; 0.98 &amp; 0.64 &amp; 0.35 &amp; 0.29 &amp; 0.22 &amp; 0.15 &amp; 0.29 \\
LMRoff &amp; 0.43 &amp; 0.51 &amp; 0.23 &amp; 1.00 &amp; 0.66 &amp; 0.37 &amp; 0.30 &amp; 0.21 &amp; 0.12 &amp; 0.31 \\
\bottomrule
\end{tabular}

</pre></div></div>
</div>
<p>Benchmarks:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LMRon_q95</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">LMRon_intra_dist</span><span class="p">,</span><span class="mf">0.95</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">LMRon_q95</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.26
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LMRoff_q95</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">LMRoff_pl_intra_dist</span><span class="p">,</span><span class="mf">0.95</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">LMRoff_q95</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.19
</pre></div></div>
</div>
</section>
<section id="Illustrate-tube-around-HadCM3">
<h3>Illustrate tube around HadCM3<a class="headerlink" href="#Illustrate-tube-around-HadCM3" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pens</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;journal_grid&#39;</span><span class="p">)</span>
<span class="n">fig_a</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">eps</span><span class="o">=</span><span class="mf">0.1</span>
<span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="n">HadCM3</span><span class="o">.</span><span class="n">make_labels</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">HadCM3</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">HadCM3</span><span class="o">.</span><span class="n">value</span><span class="o">-</span><span class="n">eps</span><span class="p">,</span> <span class="n">HadCM3</span><span class="o">.</span><span class="n">value</span><span class="o">+</span><span class="n">eps</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;HadCM3$\pm \epsilon$&#39;</span><span class="p">)</span>
<span class="n">HadCM3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ens_on</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span><span class="n">num_traces</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;LMRonline paths&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Finding HadCM3 neighbors in LMRonline&#39;</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Finding HadCM3 neighbors in LMRonline&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_eg24-Fig6_8_plume_distance_65_1.png" src="../_images/notebooks_eg24-Fig6_8_plume_distance_65_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_a</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../figures/HadCM3_tube.pdf&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="eg24-Fig5_resampling.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">[Fig. 5] Ensemble resampling</p>
      </div>
    </a>
    <a class="right-next"
       href="eg24-Fig9_plume_distance-schematic.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">[Fig. 9] Schematic for the Plume Distance</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#PMIP3-past1000-runs-vs-LMRonline">PMIP3 past1000 runs vs LMRonline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#PMIP3-simulations">PMIP3 simulations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Pathwise-Approach-:-proximity-probability">Pathwise Approach : proximity probability</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Plume-distance">Plume distance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Definition">Definition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Mathematical-Properties-of-the-Plume-Distance">Mathematical Properties of the Plume Distance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Updated-Fig-7">Updated Fig 7</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Plume-to-plume-distance">Plume-to-plume distance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#LMRoffline-vs-LMRonline">LMRoffline vs LMRonline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#PMIP3-distances-to-LMRonline">PMIP3 distances to LMRonline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Illustrate-tube-around-HadCM3">Illustrate tube around HadCM3</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Julien Emile-Geay & Feng Zhu
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Julien Emile-Geay, Feng Zhu.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>